<!DOCTYPE html>
<html class="writer-html5" lang="ja" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>FEP-1311: Media Attachments - Fediverse Enhancement Proposals 非公式日本語訳</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "FEP-1311: Media Attachments";
        var mkdocs_page_input_path = "fep/fep-1311.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Fediverse Enhancement Proposals 非公式日本語訳
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Fediverse Enhancement Proposals 非公式日本語訳</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../CONTRIBUTING/">CONTRIBUTING</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Fep</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../fep-0391/">FEP-0391: Special collection proofs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-03c1/">FEP-03c1: Actors without acct-URI</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-0499/">FEP-0499: Delivering to multiple inboxes with a multibox endpoint</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-07d7/">FEP-07d7: A Custom URL Scheme and Web-Based Protocol Handlers for Linking to ActivityPub Resources</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-0837/">FEP-0837: Federated Marketplace</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-0ea0/">FEP-0ea0: Payment Links</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">FEP-1311: Media Attachments</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#summary">Summary</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#basic-format">Basic format</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#specifying-basic-properties">Specifying basic properties</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#current-state-of-type">Current state of type</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#properties-of-the-linked-file">Properties of the linked file</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#specifying-file-properties">Specifying file properties</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#properties-of-an-image">Properties of an image</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#multiple-media-versions">Multiple Media Versions</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#testing">Testing</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#open-question">Open Question</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#content-licensing">Content Licensing</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#authentication-and-authorization">Authentication and Authorization</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#content-addressed-storage">Content addressed storage</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#mixed-media-content">Mixed media content</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#binary-fediverse-transport">Binary Fediverse transport</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#_1">参考文献</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#posts">Posts</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#_2">著作権</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-171b/">FEP-171b: Conversation Containers</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-1970/">FEP-1970: Chat Links</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-1985/">FEP-1985: Signaling how an OrderedCollection is ordered</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-1b12/">FEP-1b12: Group federation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-2100/">FEP-2100: Unbound Group and Organization</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-2277/">FEP-2277: ActivityPub core types</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-2677/">FEP-2677: Identifying the Application Actor</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-268d/">FEP-268d: Search consent signals for objects</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-2c59/">FEP-2c59: Discovery of a Webfinger address from an ActivityPub actor</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-2e40/">FEP-2e40: The FEP Vocabulary Extension Process</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-3264/">FEP-3264: Federated Work Coordination</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-37f2/">FEP-37f2: a policy for calls for consensus on SWICG group decisions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-3b86/">FEP-3b86: Activity Intents</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-400e/">FEP-400e: Publicly-appendable ActivityPub collections</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-4adb/">FEP-4adb: Dereferencing identifiers with webfinger</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-4ccd/">FEP-4ccd: Pending Followers Collection and Pending Following Collection</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-521a-test-case/">Actor Objects must express signing key as assertionMethod Multikey</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-521a/">FEP-521a: Actorの公開鍵の表現</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-5624/">FEP-5624: Per-object reply control policies</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-5bf0/">FEP-5bf0: Collection sorting and filtering</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-5e53/">FEP-5e53: Opt-out Preference Signals</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-5feb/">FEP-5feb: Search indexing consent for actors</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-612d/">FEP-612d: Identifying ActivityPub Objects through DNS</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-61cf/">FEP-61cf: The OpenWebAuth Protocol</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-6481/">FEP-6481: Specifying ActivityPub extension support with NodeInfo</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-6606/">FEP-6606: ActivityPub client to server collections addressing conventions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-67ff/">FEP-67ff: FEDERATION.md</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-6fcd/">FEP-6fcd: Account Export Container Format</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-73cd/">FEP-73cd: Migration User Stories</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-7458/">FEP-7458: Using the replies collection</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-7502/">FEP-7502: Limiting visibility to authenticated actors</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-7628/">FEP-7628: Move actor</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-76ea/">FEP-76ea: Conversation Threads</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-7888/">FEP-7888: Demystifying the context property</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-7952/">FEP-7952: Roadmap For Actor and Object Portability</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-7d8c/">FEP-7d8c: Documentation: Automation of FEP</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-888d/">FEP-888d: Using https://w3id.org/fep as a base for FEP-specific namespaces</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-8b32/">FEP-8b32: オブジェクト整合性証明</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-8c3f/">FEP-8c3f: Web Monetization</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-8fcf/">FEP-8fcf: Followers collection synchronization across servers</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-9091/">FEP-9091: Export Actor Service Endpoint</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-96ff/">FEP-96ff: Explicit signalling of ActivityPub Semantics</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-9967/">FEP-9967: Polls</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-9fde/">FEP-9fde: Mechanism for servers to expose supported operations</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-a070/">FEP-a070: Ordered properties for plain JSON consumers</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-a4ed/">FEP-a4ed: The Fediverse Enhancement Proposal Process</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-a5c5/">Web Syndication Methods</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-a974/">FEP-a974: All Actor types should be followable</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-ae0c/">FEP-ae0c: Fediverse Relay Protocols: Mastodon and LitePub</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-ae97/">FEP-ae97: Client-side activity signing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-b2b8/">FEP-b2b8: Long-form Text</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-bad1/">FEP-bad1: Object history collection</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-c0e0/">FEP-c0e0: Emoji reactions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-c118/">FEP-c118: Content licensing support</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-c16b/">FEP-c16b: MFM機能のフォーマット</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-c390/">FEP-c390: Identity Proofs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-c4ad/">Viewership History</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-c551/">FEP-c551: Use ECMAScript Modules to Create Conformance Tests for Fediverse Enhancement Proposals</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-c5a1/">FEP-c5a1: To-do's</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-c648/">FEP-c648: Blocked Collection</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-c7d3/">FEP-c7d3: Ownership</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-c893/">DOAP</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-cb76/">FEP-cb76: Content Addressed Vocabulary</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-cd47/">FEP-cd47: Federation-friendly Addressing and Deduplication Use-Cases</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-d36d/">FEP-d36d: Sharing Content Across Federated Forums</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-d556/">FEP-d556: Server-Level Actor Discovery Using WebFinger</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-d767/">FEP-d767: Extend ActivityPub with Valueflows</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-d8c2/">FEP-d8c2: OAuth 2.0 Profile for the ActivityPub API</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-d9ad/">FEP-d9ad: Create Conformance Tests for Fediverse Enhancement Proposals</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-db0e/">FEP-db0e: Authentication mechanism for non-public groups</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-dc88/">FEP-dc88: Formatting Mathematics</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-dd4b/">FEP-dd4b: Quote Posts</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-e229/">FEP-e229: Best practices for extensibility</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-e232/">FEP-e232: オブジェクトリンク</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-e3e9/">FEP-e3e9: Actor-Relative URLs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-e965-test-case/">Actor Object Migration and Deactivation Syntax</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-e965/">FEP-e965: Move Activity for Migrations and Announce Activity for Tombstone Events</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-eb22/">FEP-eb22: Supported ActivityStreams types with NodeInfo</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-eb48/">Timeline Preferences</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-ef61/">FEP-ef61: Portable Objects</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-efda/">FEP-efda: Followable objects</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-f06f/">FEP-f06f: Object observers</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-f1d5/">FEP-f1d5: FediverseソフトウェアのNodeinfo</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-f228/">FEP-f228: Backfilling conversations</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-fb2a/">FEP-fb2a: Actor metadata</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-fe34/">FEP-fe34: Origin-based security model</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fep-fffd/">FEP-fffd: Proxy Objects</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Fediverse Enhancement Proposals 非公式日本語訳</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Fep</li>
      <li class="breadcrumb-item active">FEP-1311: Media Attachments</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/AmaseCocoa/fep-ja/edit/master/docs/fep/fep-1311.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="fep-1311-media-attachments">FEP-1311: Media Attachments</h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>このFEPはまだ翻訳されていません。</p>
<p><a href="https://github.com/AmaseCocoa/fep-ja/edit/master/docs/fep/fep-1311.md">ここ</a>から翻訳に協力することができます。</p>
</div>
<h2 id="summary">Summary</h2>
<p>Media Attachments are ubiquitous in the Fediverse. My quick investigation
into the explore tab on <code>mastodon.social</code> yields that about half the
posts contain an image attachment. The mechanism for these is poorly
documented. For example, it is not mentioned in <a href="https://www.w3.org/TR/activitypub/">ActivityPub</a>.</p>
<p>My goal in this FEP is to document current usage, and issue recommendations
on how to improve it. These recommendations are based on the
support table <em>Recommended Media Attachment Format</em>
available at <a href="https://funfedi.dev/support_tables/generated/recommended_attachments/">FunFedi.dev</a>.</p>
<p>For developers that enjoy making their keyboards smoke, I believe
that the above link combined with the content of <a href="#testing">Testing</a>
should be enough to adapt their Fediverse applications.
The other parts are meant for people, who which to improve
the situation related to media attachments.</p>
<h2 id="basic-format">Basic format</h2>
<p>We will discuss our basic suggested format with the following
example of an image attachment.</p>
<pre><code class="language-json">{
    &quot;type&quot;: &quot;Image&quot;,
    &quot;name&quot;: &quot;A beautiful cow&quot;,
    &quot;url&quot;: &quot;http://pasture-one-actor/assets/cow.jpg&quot;,
    &quot;width&quot;: 100,
    &quot;height&quot;: 162,
    &quot;mediaType&quot;: &quot;image/jpeg&quot;,
    &quot;digestMultibase&quot;: &quot;zQmaeDPzhNL32WQZnnzB1H6QJWvvFNEHdViDB71yrxyXU1t&quot;,
    &quot;size&quot;: 9045
}
</code></pre>
<p>There is a lot to say here, first how does this relate to communication
in <a href="https://www.w3.org/TR/activitypub/">ActivityPub</a> which is done by activity. For this consider the
activity (taken from <a href="https://data.funfedi.dev/0.1.11/akkoma__v3.13.3/recommended_attachments">data.funfedi.dev</a>) given by</p>
<pre><code class="language-json">{
  &quot;@context&quot;: [
      &quot;https://www.w3.org/ns/activitystreams&quot;,
      &quot;https://www.w3.org/ns/credentials/v2&quot;,
      {
        &quot;size&quot;: &quot;https://joinpeertube.org/ns#size&quot;
      }
    ],
  &quot;type&quot;: &quot;Create&quot;,
  &quot;actor&quot;: &quot;http://pasture-one-actor/actor&quot;,
  &quot;to&quot;: [
    &quot;http://akkoma/users/witch&quot;,
    &quot;https://www.w3.org/ns/activitystreams#Public&quot;
  ],
  &quot;id&quot;: &quot;http://pasture-one-actor/actor/S5Szzuugy50&quot;,
  &quot;published&quot;: &quot;2024-12-05T08:18:48Z&quot;,
  &quot;object&quot;: {
    &quot;type&quot;: &quot;Note&quot;,
    &quot;attributedTo&quot;: &quot;http://pasture-one-actor/actor&quot;,
    &quot;to&quot;: [
      &quot;https://www.w3.org/ns/activitystreams#Public&quot;,
      &quot;http://akkoma/users/witch&quot;
    ],
    &quot;id&quot;: &quot;http://pasture-one-actor/actor/qDqgbPpNQPw&quot;,
    &quot;published&quot;: &quot;2024-12-05T08:18:48Z&quot;,
    &quot;content&quot;: &quot;Recommended Image Format&quot;,
    &quot;attachment&quot;: [
      {
        &quot;type&quot;: &quot;Image&quot;,
        &quot;name&quot;: &quot;A beautiful cow&quot;,
        &quot;url&quot;: &quot;http://pasture-one-actor/assets/cow.jpg&quot;,
        &quot;width&quot;: 100,
        &quot;height&quot;: 162,
        &quot;mediaType&quot;: &quot;image/jpeg&quot;,
        &quot;digestMultibase&quot;: &quot;zQmaeDPzhNL32WQZnnzB1H6QJWvvFNEHdViDB71yrxyXU1t&quot;,
        &quot;size&quot;: 9045
      }
    ]
  }
}
</code></pre>
<p>We note that the media attachment is contained in the array of
<code>attachment</code> of the <code>Note</code> object. Furthermore, in difference
to the activity and the object, there is no <code>id</code> property
nor <code>actor</code> or <code>attributedTo</code> property. This is on purpose,
as those are inherited from the object the media attachment
is attached to. See <a href="#content-licensing">Content Licensing</a>
for discussion about not having an <code>attributedTo</code> property.</p>
<p>In particular, one should emphasize that a media attachment
not having an <code>id</code> is useful to signify that it is not useful
as an object without the note, it is attached to.</p>
<h3 id="specifying-basic-properties">Specifying basic properties</h3>
<p>To use media attachments, an object MUST have an <code>attachment</code>
property, whose value is an array containing objects.
Furthermore, the contained objects MUST have a type
property. For it to be a media attachment the type
property MUST be <code>Audio</code>, <code>Image</code>, or <code>Video</code>. However,
the attachment property MAY contain other form
of attachments, e.g. <a href="https://codeberg.org/fediverse/fep/src/branch/main/fep/0ea0/fep-0ea0.md">FEP-0ea0: Payment Links</a>.</p>
<p>This can be expressed as the json-schema:</p>
<pre><code class="language-json">{
  &quot;$schema&quot;: &quot;https://json-schema.org/draft/2020-12/schema&quot;,
  &quot;type&quot;: &quot;object&quot;,
  &quot;properties&quot;: {
    &quot;attachment&quot;: {
      &quot;type&quot;: &quot;array&quot;,
      &quot;items&quot;: {
        &quot;type&quot;: &quot;object&quot;,
        &quot;properties&quot;: {
          &quot;type&quot;: {
            &quot;type&quot;: &quot;string&quot;,
            &quot;examples&quot;: [&quot;Audio&quot;, &quot;Image&quot;, &quot;Video&quot;]
          }
        },
        &quot;required&quot;: [&quot;type&quot;]
      }
    }
  },
  &quot;required&quot;: [&quot;attachment&quot;]
}
</code></pre>
<p>We now discuss the specific form a media attachment.
In addition to <code>type</code>, a media attachment MUST also
contain an <code>url</code> property providing the link
to the media. The <code>url</code> property MAY also be
an array, see <a href="#multiple-media-versions">Multiple Media Versions</a>.
However, this just to be future proof.</p>
<p>Furthermore, media attachments SHOULD contain
a <code>name</code> property providing an alternative plain text
description of the media object.</p>
<p>Again this can be represented as a json-schema.</p>
<pre><code class="language-json">{
  &quot;$schema&quot;: &quot;https://json-schema.org/draft/2020-12/schema&quot;,
  &quot;type&quot;: &quot;object&quot;,
  &quot;properties&quot;: {
    &quot;type&quot;: {
      &quot;type&quot;: &quot;string&quot;,
      &quot;enum&quot;: [&quot;Audio&quot;, &quot;Image&quot;, &quot;Video&quot;]
    },
    &quot;name&quot;: {
      &quot;type&quot;: &quot;string&quot;,
      &quot;examples&quot;: [&quot;A beautiful cow&quot;]
    },
    &quot;url&quot;: {
      &quot;type&quot;: [&quot;string&quot;, &quot;array&quot;],
      &quot;examples&quot;: [&quot;http://you.example/image.png&quot;]
    }
  },
  &quot;required&quot;: [&quot;type&quot;, &quot;url&quot;]
}
</code></pre>
<h3 id="current-state-of-type">Current state of type</h3>
<p>Many current implementations use <code>Document</code> for media attachments.
This has the distinct disadvantage to using <code>Audio</code>, <code>Image</code>,
or <code>Video</code> that the parser needs to inspect more content than
<code>type</code> to discover what type of attachment it is.</p>
<p>Let's write a bit of python to determine if something is
a media attachment based on <code>mediaType</code>, discussed later.</p>
<pre><code class="language-python">def is_media(attachment:dict) -&gt; bool:
    media_type = attachment.get(&quot;mediaType&quot;)
    if media_type is None:
        ... # handle error case

    main_type, _ = media_type.split(&quot;/&quot;, 1)

    return main_type in [&quot;audio&quot;, &quot;image&quot;, &quot;video&quot;]
</code></pre>
<p>This already is fairly complicated, but there is more. If
one allows <code>url</code> to be an array, one needs a different check,
so it turns into something like:</p>
<pre><code class="language-python">def is_media(attachment:dict) -&gt; bool:
    url = attachment.get(&quot;url&quot;)
    if isinstance(url, list):
        return is_media(url[0])

    media_type = attachment.get(&quot;mediaType&quot;)
    if media_type is None:
        ... # handle error case

    main_type, _ = media_type.split(&quot;/&quot;, 1)

    return main_type in [&quot;audio&quot;, &quot;image&quot;, &quot;video&quot;]
</code></pre>
<p>There are more exceptions and poor configuration to treat,
e.g. url could be an empty list, or the implementation
could attach <code>mediaType</code> to the full object instead
of the <code>Link</code>.</p>
<p>The goal of a specification needs to be to simplify the code
that needs to be written, so we insist on people using
the types <code>Audio</code>, <code>Image</code>, and <code>Video</code> for media
attachments.</p>
<h2 id="properties-of-the-linked-file">Properties of the linked file</h2>
<p>In this section, we discuss properties related to the linked file. The linked file is retrieved either by performing a <code>GET</code> request on the value of <code>url</code> or on <code>href</code> of the <code>Link</code> objects if <code>url</code> is an array. Just to mention it, this requirement might change, once <a href="#authentication-and-authorization">Authentication and Authorization</a> is dealt with.</p>
<p>Let's look back at our original example of a media attachment</p>
<pre><code class="language-json">{
    &quot;type&quot;: &quot;Image&quot;,
    &quot;name&quot;: &quot;A beautiful cow&quot;,
    &quot;url&quot;: &quot;http://pasture-one-actor/assets/cow.jpg&quot;,
    &quot;width&quot;: 100,
    &quot;height&quot;: 162,
    &quot;mediaType&quot;: &quot;image/jpeg&quot;,
    &quot;digestMultibase&quot;: &quot;zQmaeDPzhNL32WQZnnzB1H6QJWvvFNEHdViDB71yrxyXU1t&quot;,
    &quot;size&quot;: 9045
}
</code></pre>
<p>Here the linked file is given by a <code>GET</code> on <code>http://pasture-one-actor/assets/cow.jpg</code> and the result would be</p>
<p><img alt="A beautiful cow" src="./cow.jpg" /></p>
<p>The properties <code>mediaType</code>, <code>digestMultibase</code>, and <code>size</code> could
be valid for any attached file, even a non media one, e.g.
a text document. Let's quickly review them. <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-mediatype">mediaType</a> is defined
in the <a href="https://www.w3.org/TR/activitystreams-vocabulary/">ActivityStreams Vocabulary</a>. It describes the MIME type
and tells us important information on how to render the file.</p>
<p><code>digestMultibase</code> is defined <a href="https://w3c.github.io/vc-data-integrity/#resource-integrity">here</a> as part
of <a href="https://w3c.github.io/vc-data-integrity/">Verifiable Credential Data Integrity</a>. The
encoding of a digest in multibase with <a href="https://www.multiformats.io/multihash/">multihash</a> is somewhat different to the rest of multicodec,
because one first has a byte to indicate the format, then another one
to indicate the length. This means in particular that all
<code>digestMultibase</code> using <code>sha-256</code> will start with <code>zQm</code>, the <code>z</code> indicating
base58 encoding. Checking the digest is important to ensure <strong>integrity</strong>.
As media is often hosted off site using S3, this seems important.
For another usage see <a href="#content-addressed-storage">Content Addressed Storage</a>.</p>
<p>Finally <code>size</code> being the file size in bytes is borrowed from PeerTube.
The <code>size</code> should tell us if we want to preload the media or not.</p>
<p>There is something missing in the file properties: <em>access control</em>, see
the section <a href="#authentication-and-authorization">Authentication and Authorization</a>
in the open questions below.</p>
<h3 id="specifying-file-properties">Specifying file properties</h3>
<p>The creator of a media attachment SHOULD include the
values of <code>mediaType</code>, <code>digestMultibase</code>, and <code>size</code>. The
consumer of a media attachment SHOULD ensure integrity
of the downloaded attachment based on <code>digestMultibase</code>,
i.e. check the digest. The consumer of a media attachment
SHOuLD decide based on <code>size</code> and <code>mediaType</code> the best way
to consume the attachment.</p>
<p><code>size</code> and <code>mediaType</code> become more relevant when
<a href="#multiple-media-versions">multiple versions of the media attachment</a>
are provided. For example, this could mean that in one
feeds one only sees the low quality video by default.</p>
<h2 id="properties-of-an-image">Properties of an image</h2>
<p>We have now discussed all properties of our example document
except for <code>width</code> and <code>height</code>. These properties are only
relevant for an image and a video, but not for audio. Similarly, audio and video can have a <code>duration</code>, which images don't. Finally, Mastodon has introduced the additional properties</p>
<ul>
<li><a href="https://docs.joinmastodon.org/spec/activitypub/#focalPoint"><code>focalPoint</code></a></li>
<li><a href="https://docs.joinmastodon.org/spec/activitypub/#blurhash"><code>blurHash</code></a></li>
</ul>
<p>where at least <code>focalPoint</code> is user defined. There are a lot
of other properties one can consider for media, e.g.</p>
<ul>
<li>Where was the picture taken? e.g. <code>location</code></li>
<li>What is the frame rate of the video? e.g. <code>fps</code></li>
<li>Provide an album cover for audio?</li>
</ul>
<p>In order to standardize these things further work is needed.</p>
<h2 id="multiple-media-versions">Multiple Media Versions</h2>
<p>As it is currently not supported in the Fediverse,
I will just give the basic example how to use multiple
attached Links:</p>
<pre><code class="language-json">{
  &quot;type&quot;: &quot;Video&quot;,
  &quot;name&quot;: &quot;A beautiful cow eating&quot;,
  &quot;url&quot;: [
    {
      &quot;type&quot;: &quot;Link&quot;,
      &quot;size&quot;: 54373,
      &quot;digest&quot;: &quot;zQmSzK5qEe5tpjwGMhmjx9RvVoPkWhEmCwxP2s7wPMpKMoK&quot;,
      &quot;width&quot;: 256,
      &quot;height&quot;: 144,
      &quot;href&quot;: &quot;http://pasture-one-actor/assets/cow_eating.mp4&quot;,
      &quot;mediaType&quot;: &quot;video/mp4&quot;
    },
    {
      &quot;type&quot;: &quot;Link&quot;,
      &quot;size&quot;: 2271723,
      &quot;digest&quot;: &quot;zQme2X4rgWuRdmAtGGMSEbdoeRQ2NAL2VptcdRGTYDZbSKG&quot;,
      &quot;width&quot;: 1920,
      &quot;height&quot;: 1080,
      &quot;href&quot;: &quot;http://pasture-one-actor/assets/cow_eating_hd.mp4&quot;,
      &quot;mediaType&quot;: &quot;video/mp4&quot;
    }
  ],
  &quot;duration&quot;: &quot;PT3S&quot;
}
</code></pre>
<p>As the example shows, this is useful to attach both a low quality
version (54kb) and a high quality one (2.2MB) of a video.</p>
<p>We think that supporting this will open the door for richer
applications.</p>
<h2 id="testing">Testing</h2>
<p>By using json-schema, one can validate some level of correctness
of generated media attachments. Relevant schemas
are available at <a href="https://schemas.funfedi.dev/">Fediverse schemas</a> for media
attachments. They can be combined into a feature test
using Gherkin, see <a href="https://codeberg.org/helge/fediverse-features/src/branch/main/features/schema/schema_media.feature">Media Format</a>.</p>
<p>If you wish to validate everything, including digest,
you can use the examples provided at <a href="https://funfedi.dev/support_tables/generated/recommended_attachments/">FunFedi.dev</a>.</p>
<h2 id="open-question">Open Question</h2>
<p>This section is essentially a todo list for the community
on stuff that should be fixed, but isn't yet.</p>
<h3 id="content-licensing">Content Licensing</h3>
<p>The picture in the examples was created based on <a href="https://pixabay.com/photos/highland-cow-cow-cattle-animal-8678950/">this picture</a> available for
free on pixabay by photographer <a href="https://pixabay.com/users/derekmuller-1225161/">derekmuller</a>.
Unfortunately, the current standards to not let me attach
this information to my media object.</p>
<p>One could now say that this could be solved with just
using the <code>attributedTo</code> property. Unfortunately, this
has a lot of drawbacks. For example <a href="https://pixabay.com/users/derekmuller-1225161/">derekmuller</a>
is not an ActivityPub actor. Also attributing my cropped
low resolution image to him, might be something he does not appreciate.
Finally, just attributing this image is probably not enough,
one should also inform people on how it is licensed.</p>
<p>See <a href="https://codeberg.org/fediverse/fep/src/branch/main/fep/c118/fep-c118.md">FEP-c118</a> and its discussions for more on the topic.</p>
<h3 id="authentication-and-authorization">Authentication and Authorization</h3>
<p>Currently, image links must be accessible without any
form of authorization. This is due while communication
between a user and their server requiring authentication
and between servers requiring authentication, images
are often stored on third party services, e.g. S3,
thus adding authentication is hard.</p>
<p>For some approaches to resolve this see <a href="https://mitra.social/post/01939c02-dedc-dc4c-0431-a5fe7925b337">this Fediverse discussion</a>.</p>
<p>One approach to achieve authentication and authorization
easily with existing technologies would be <a href="https://docs.joinmastodon.org/spec/bearcaps/">Bearcaps</a>.</p>
<p>For a different approach see also <a href="#binary-fediverse-transport">Binary Fediverse transport</a>.</p>
<h3 id="content-addressed-storage">Content addressed storage</h3>
<p>Storing media is costly. It is thus important to avoid
duplication. By having a digest for all media through
the <code>digestMultibase</code> property, we can use this to
index our media storage. This means that before downloading
a file, we can check if we already have it.</p>
<h3 id="mixed-media-content">Mixed media content</h3>
<p>Consider posting a song, e.g. something from the brat summer, then
you might want to attach the album cover, e.g. an image featuring
the color <code>#8ACE00</code>. Maybe you will also want to attach some
lyrics. This means that your media content contains three parts
of separate media type.</p>
<p>One might want to extend the schema for media attachments to convey
this information.</p>
<h3 id="binary-fediverse-transport">Binary Fediverse transport</h3>
<p>A failure of <a href="https://www.w3.org/TR/activitypub/">ActivityPub</a> is that it restricts transport to
be JSON. ActivityPub thus forces people to use external means, e.g.
download the file, to convey media content.</p>
<p>One could solve some problems, e.g.
<a href="#authentication-and-authorization">Authentication and Authorization</a>,
by just allowing transport of binary blobs. This would require
an extension of the wire format.</p>
<p>Allowing for messages to contain binary blobs would also for
sharing media via thick clients.</p>
<h2 id="_1">参考文献</h2>
<ul>
<li>Christine Lemmer Webber, Jessica Tallon, <a href="https://www.w3.org/TR/activitypub/">ActivityPub</a>, 2018</li>
<li>Helge, <a href="https://funfedi.dev/support_tables/generated/recommended_attachments/">FunFedi.dev: Recommended Media Attachment Format</a></li>
<li>Helge / funfedi.dev <a href="https://data.funfedi.dev/0.1.11/akkoma__v3.13.3/recommended_attachments">Interoperability Data for the Fediverse</a>, akkoma v3.13.3, inputs 0.1.11, Recommended Media Attachment Format, example 1</li>
<li>Tim Bray, <a href="https://codeberg.org/fediverse/fep/src/branch/main/fep/c118/fep-c118.md">FEP-c118: Content licensing support</a></li>
<li><a href="https://pixabay.com/users/derekmuller-1225161/">Pixabay user derekmuller</a></li>
<li>silverpill, <a href="https://codeberg.org/fediverse/fep/src/branch/main/fep/0ea0/fep-0ea0.md">FEP-0ea0: Payment Links</a></li>
<li>Helge, <a href="https://codeberg.org/helge/fediverse-features/src/branch/main/features/schema/schema_media.feature">Feature: Media Attachments</a> part of fediverse-features</li>
<li>Helge, <a href="https://schemas.funfedi.dev/">Schemas for the Fediverse</a></li>
<li>Mastodon, <a href="https://docs.joinmastodon.org/spec/bearcaps/">Bearcaps</a></li>
</ul>
<h2 id="posts">Posts</h2>
<ul>
<li><a href="https://mitra.social/post/01939c02-dedc-dc4c-0431-a5fe7925b337">Social Media Post</a> by silverpill et al. Relevant parts:</li>
</ul>
<blockquote>
<p>Apparently Streams has some mechanism for protecting attachments. Media URLs in non-public posts look like this:
https://{domain}/photo/{filename}.jpg?token={token}</p>
<p>IIRR at least in Hubzilla that token is just part of OpenWebAuth's "magic authentication". Where I guess the token contains info about which instance(s?) to contact in order to verify your identity. The audience is kept in the media server(s) database and sync'ed between clones.</p>
</blockquote>
<h2 id="_2">著作権</h2>
<p>CC0 1.0 ユニバーサル (CC0 1.0) パブリック ドメイン</p>
<p>法律で認められる範囲において、この Fediverse 拡張提案の著者は、この作品に対するすべての著作権および関連する権利または隣接する権利を放棄しています。</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../fep-0ea0/" class="btn btn-neutral float-left" title="FEP-0ea0: Payment Links"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../fep-171b/" class="btn btn-neutral float-right" title="FEP-171b: Conversation Containers">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/AmaseCocoa/fep-ja" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../fep-0ea0/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../fep-171b/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
